# ComfyUI Dynamic Workflow Server Configuration
# 
# ============================================================================
# 使用说明:
# 1. 在 ComfyUI 中设计好工作流
# 2. 点击 "Save" 保存工作流 JSON 文件（普通格式或 API 格式均可）
# 3. 将 JSON 文件放到 workflows/ 目录
# 4. 在下方 workflows 配置中添加工作流信息，定义输入输出映射
# 5. 启动服务: python -m app.main
#
# 注意: 服务会自动检测并转换工作流格式，无需手动导出 API 格式！
# ============================================================================

# ComfyUI 配置
comfyui:
  # ComfyUI 目录路径
  # 如果不填，会自动查找当前目录下的 ComfyUI 文件夹
  directory: null

  # 额外模型路径配置（可选）
  extra_model_paths: null

  # 输出文件访问 URL 前缀
  base_url: "http://localhost:6006"

  # 模型内存管理（控制是否将模型保留在 GPU 内存中）
  # - highvram: 将所有模型保留在 GPU 内存中（适合 80GB+ 显存）
  # - normalvram: 标准模式，根据需要加载/卸载模型
  # - lowvram: 低显存模式，仅保留当前使用的模型
  vram_mode: "highvram"

# 文件目录配置
storage:
  # 上传图片目录（ComfyUI LoadImage 节点需要从这里读取）
  input_directory: "ComfyUI/input"
  
  # 输出文件目录（相对于项目根目录，或绝对路径）
  output_directory: "outputs"
  
  # 自动清理配置
  cleanup:
    enabled: true           # 是否启用自动清理
    interval_hours: 3       # 清理间隔（小时）
    max_age_days: 15        # 文件保留天数，超过则删除

# 服务器配置
server:
  host: "0.0.0.0"
  port: 6006

# ============================================================================
# 工作流配置
# ============================================================================
# 每个工作流通过 type 字段决定可用的 API 路由
# 请求时通过 model 参数选择具体工作流
#
# 配置说明:
#   name: 工作流名称，作为 API 请求的 model 参数值 (必填)
#   type: 工作流类型列表，决定可用的路由 (必填)
#     - 可选值: "image-to-image", "image-to-video", "text-to-image", "text-to-video"
#     - 一个工作流可以支持多种类型
#   path: 工作流 JSON 路径，相对于项目根目录 (必填)
#   description: 工作流描述 (可选)
#   inputs: 输入参数映射 (可选)
#     - 格式: {友好名称}: {节点参数}
#     - 节点参数格式: {input_key}_{node_id}
#     - 例如: prompt: "text_6" 表示 API 的 prompt 字段映射到节点 6 的 text 输入
#   outputs: 输出节点配置 (可选)
#     - 格式: {输出名称}: {节点类型}
#     - 例如: image: "SaveImage" 表示从 SaveImage 节点提取输出
#
# API 路由:
#   POST /image-to-image  - 图生图，需要 type 包含 "image-to-image"
#   POST /image-to-video  - 图生视频，需要 type 包含 "image-to-video"
#   POST /workflow/{name} - 通用接口，直接指定工作流名称
#
# ============================================================================
# 配置示例:
# 
# workflows:
#   # 文生图工作流
#   - name: "sd15_t2i"
#     type: ["text-to-image"]
#     path: "workflows/sd15_t2i.json"
#     description: "SD1.5 文生图"
#     inputs:
#       prompt: "text_6"              # 正向提示词
#       negative_prompt: "text_7"     # 反向提示词
#       seed: "seed_3"                # 随机种子
#       steps: "steps_3"              # 采样步数
#       width: "width_5"              # 图片宽度
#       height: "height_5"            # 图片高度
#     outputs:
#       image: "SaveImage"            # 输出图片
#
#   # 图生视频工作流（支持多种输入方式）
#   - name: "wan_i2v"
#     type: ["image-to-video", "text-to-video"]  # 支持图生视频和文生视频
#     path: "workflows/wan_i2v.json"
#     description: "Wan2.2 图生视频"
#     inputs:
#       image: "image_1"              # 输入图片（支持 base64/URL/文件名）
#       prompt: "text_6"              # 提示词
#       negative_prompt: "text_7"     # 反向提示词
#       seed: "seed_10"               # 随机种子
#       frames: "frames_15"           # 帧数
#     outputs:
#       video: "VHS_VideoCombine"     # 输出视频
#
# ============================================================================

workflows:
  # Qwen Image Edit 2511-AIO 工作流（4张输出）
  # 支持多图编辑，输入 1-3 张图片 + 编辑指令，输出 4 张图片
  - name: "qwen_edit_aio"
    type: ["image-to-image"]        # 工作流类型，决定可用的 API 路由
    path: "workflows/qwen-edit-aio.json"
    description: "千问 Qwen Edit 2511-AIO（4张输出）"
    inputs:
      image1: "image_36"            # 主输入图片
      image2: "image_35"            # 第二张图片（可选）
      image3: "image_37"            # 第三张图片（可选）
      prompt: "prompt_11"           # 编辑提示词
      positive_prompt: "prompt_11"  # 编辑提示词（别名）
      seed: "seed_5"                # 随机种子
      steps: "steps_5"              # 采样步数
      cfg: "cfg_5"                  # CFG 强度
      megapixels: "megapixels_59"   # 输出图片像素数（默认 1.2）
      batch_size: "amount_62"       # 输出数量（默认 4）
    outputs:
      image: "SaveImage"

  # WAN2.2 RemixV2 图生视频工作流
  # 基于 WAN2.2 模型的图生视频，支持高质量视频生成
  - name: "wan22_remix_i2v"
    type: ["image-to-video"]        # 工作流类型
    path: "workflows/【Work-FIsh】WAN2.2-RemixV2-I2V图生视频.json"
    description: "WAN2.2 RemixV2 图生视频"
    # 覆盖 workflow 中的节点配置
    # overrides:
    #   "1":  # 低噪声-Patch Sage Attention KJ
    #     widgets_values: ["disabled"]
    #   "2":  # 高噪声-Patch Sage Attention KJ
    #     widgets_values: ["disabled"]
    inputs:
      image: "image_78"             # 输入图片（支持 base64/URL/文件名）
      positive_prompt: "text_72"    # 正向提示词
      negative_prompt: "text_3"     # 反向提示词
      frames: "value_59"            # 帧数（默认 81，即约 5 秒）
      steps: "value_57"             # 总步数（默认 6）
      seed: "noise_seed_54"         # 随机种子
    outputs:
      video: "VHS_VideoCombine"     # 输出视频


